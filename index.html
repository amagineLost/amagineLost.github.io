<script>
    const scriptsList = document.getElementById('scripts-list');
    const btnEdit = document.querySelector('.btn-edit');
    let scripts = []; // Store scripts globally to access them later

    async function fetchScripts() {
        try {
            const response = await fetch('http://localhost:3000/api/scripts');
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Fetch error: ', error);
        }
    }

    async function updateScripts(updatedScripts) {
        console.log('Updating scripts:', updatedScripts); // Debugging statement
        try {
            const response = await fetch('http://localhost:3000/api/scripts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedScripts)
            });
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
        } catch (error) {
            console.error('Update error: ', error);
        }
    }

    async function renderScripts() {
        scripts = await fetchScripts(); // Assign fetched scripts to the global variable
        if (scripts) {
            scriptsList.innerHTML = '';
            scripts.forEach(script => {
                const scriptItem = document.createElement('div');
                scriptItem.className = 'script-item';
                scriptItem.innerHTML = `
                    <h3>${script.title}</h3>
                    <pre class="script-content">${script.content}</pre>
                `;
                scriptsList.appendChild(scriptItem);
            });
        }
    }

    function toggleEdit() {
        if (btnEdit.textContent === 'Edit Scripts') {
            btnEdit.textContent = 'Save Changes';
            fetchScripts().then(scripts => {
                if (scripts) {
                    scriptsList.innerHTML = '';
                    scripts.forEach((script, index) => {
                        const scriptItem = document.createElement('div');
                        scriptItem.className = 'script-item';
                        scriptItem.innerHTML = `
                            <h3>${script.title}</h3>
                            <textarea class="script-content" rows="10" cols="50">${script.content}</textarea>
                        `;
                        scriptsList.appendChild(scriptItem);
                    });
                }
            });
        } else {
            btnEdit.textContent = 'Edit Scripts';
            const textareas = document.querySelectorAll('.script-content');
            const updatedScripts = [];
            textareas.forEach((textarea, index) => {
                updatedScripts.push({ title: scripts[index].title, content: textarea.value });
            });
            console.log('Saving updated scripts:', updatedScripts); // Debugging statement
            updateScripts(updatedScripts).then(() => {
                renderScripts();
                console.log('Scripts updated successfully'); // Debugging statement
            });
        }
    }

    function authenticate() {
        const password = prompt('Enter the password to edit scripts:');
        if (password === 'testing') {
            btnEdit.style.display = 'block';
        }
    }

    renderScripts();
    authenticate();
</script>
